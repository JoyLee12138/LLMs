&lt;!--
Software-Engineering-Document
MIT License | https://github.com/cuizhenjie/software-engineering-document
--&gt;

# 软件工程全生命周期文档模板

&gt; 适用于瀑布 / 敏捷双模式，可插拔式章节，按需保留或删除

---

## 0 目录

- [1 可行性分析报告](#1-可行性分析报告)
- [2 项目开发计划](#2-项目开发计划)
- [3 需求规格说明书](#3-需求规格说明书)
- [4 概要设计说明书](#4-概要设计说明书)
- [5 详细设计说明书](#5-详细设计说明书)
- [6 测试计划](#6-测试计划)
- [7 测试分析报告](#7-测试分析报告)
- [8 用户操作手册](#8-用户操作手册)
- [9 项目开发进度月报](#9-项目开发进度月报)
- [10 项目开发总结报告](#10-项目开发总结报告)
- [11 软件维护手册](#11-软件维护手册)

---

## 1 可行性分析报告

### 1.1 编写目的

说明本次可行性研究的目标、预期读者及对应阅读建议。

### 1.2 背景

- 软件名称：[待填写]
- 项目提出者：[待填写]
- 开发者：[待填写]
- 用户目标：[待填写]

### 1.3 定义

列出本文档中使用的专门术语、外文首字母组词的原词组。

### 1.4 参考资料

| 文档            | 版本 | 来源     |
| --------------- | ---- | -------- |
| 招标书 / 投标书 | v1.0 | 甲方提供 |

### 1.5 研究前提

- 功能约束
- 性能约束（并发、峰值、响应时间）
- 平台约束（操作系统、浏览器、移动端）

### 1.6 技术可行性

- 候选架构方案对比（架构图 + SWOT）
- 复用策略（开源组件、内部平台）
- 风险评估及缓解措施

### 1.7 经济可行性

- 成本估算（CAPEX / OPEX）
- 收益预测（降本、增收、ROI）
- 盈亏平衡点

### 1.8 社会可行性

- 法律法规（数据跨境、GDPR、等保 2.0）
- 用户隐私与道德风险
- 组织变革与人员培训

### 1.9 结论与建议

- 立即启动 / 条件启动 / 暂缓 / 终止
- 下一步工作（PoC、原型、预算申请）

---

## 2 项目开发计划

### 2.1 项目范围

- 主要交付物
- 非项目范围（明确排除）

### 2.2 里程碑

| 里程碑        | 日期       | 交付清单           |
| ------------- | ---------- | ------------------ |
| M1 需求确认   | 2025-07-01 | 需求基线、原型     |
| M2 设计评审   | 2025-08-15 | 概设文档、接口定义 |
| M3 上线试运行 | 2025-11-30 | 可执行包、测试报告 |

### 2.3 资源计划

- 人力资源（角色、职责、投入比例）
- 硬件资源（服务器、测试设备）
- 软件资源（IDE、License、云资源）

### 2.4 进度计划

采用甘特图或敏捷迭代地图，建议工具：GanttProject / Jira / 甘特图 Markdown 插件。

### 2.5 预算与成本基线

- 人力成本
- 工具/设备成本
- 应急储备（5%~10%）

### 2.6 沟通计划

| 会议          | 频率 | 参与人 | 输出       |
| ------------- | ---- | ------ | ---------- |
| 每日站会      | 每天 | Dev+QA | 燃尽图更新 |
| Sprint Review | 2 周 | 全员   | 可交付增量 |

### 2.7 风险及应对

- 技术风险（新技术不稳定）
- 外部依赖风险（第三方接口延迟）
- 人员风险（关键角色离职）

---

## 3 需求规格说明书

### 3.1 业务需求

- 业务痛点
- 业务目标（SMART 原则）

### 3.2 用户需求（用例图）

- 角色：普通用户 / 管理员 / 外部系统
- 用例：注册、登录、下单、报表查看 …

### 3.3 功能需求

&gt; 采用“用户故事”或“功能清单”均可，建议统一编号，如 FUNC-01xx

#### FUNC-0101 用户注册

- 输入：手机号、验证码、密码
- 处理：校验唯一性、加密存储
- 输出：创建会话、发送欢迎短信

### 3.4 非功能需求

| 类别   | 指标                   | 场景           |
| ------ | ---------------------- | -------------- |
| 性能   | 95% 接口 ≤ 300 ms      | 1w 并发        |
| 可用性 | 年可用性 ≥ 99.9%       | 含计划内维护   |
| 安全   | 通过 OWASP Top 10 检测 | 第三方渗透报告 |

### 3.5 外部接口需求

- 支付网关：支付宝 OpenAPI v3
- 短信网关：腾讯云 SMS
- 数据字典：与 ERP 同步字段定义

### 3.6 验收标准

- 功能通过率 100%（关键路径）
- 性能达标且连续 7 天无故障
- 文档齐全并通过配置审计

---

## 4 概要设计说明书

### 4.1 总体架构

````plaintext
                 ┌──────────────┐
                 │  Load Balancer │
                 └──────┬───────┘
                        ▼
                 ┌──────────────┐
                 │  API Gateway  │
                 └──────┬───────┘
        ┌──────────────┴──────────────┐
        ▼                             ▼
┌──────────────┐              ┌──────────────┐
│  User Service │              │ Order Service │
└──────────────┘              └──────────────┘
        │                             │
        ▼                             ▼
┌──────────────┐              ┌──────────────┐
│  MySQL       │              │  Redis       │
└──────────────┘              └──────────────┘

- 所有无状态服务以 Deployment 形式部署，HPA 基于 CPU 60% 和 QPS 双指标
- 有状态中间件使用 StatefulSet + 本地 SSD，跨可用区反亲和
- 灰度发布：Argo Rollout 提供金丝雀与蓝绿两种策略，按 header=canary 分流 5%→25%→100%

### 4.6 灾备与可用性指标

| 等级 | 目标 | 技术手段 |
|---|---|---|
| 高可用 | 年可用性 99.9%（≈ 8.77 h） | 同城双活 + 异地冷备 |
| 数据持久性 | 99.99999999% | 半同步复制 + 每日全备 + 24 h 增量 |
| RPO | ≤ 5 min | 消息队列持久化 + 应用幂等 |
| RTO | ≤ 30 min | 容器镜像预热、一键切换脚本 |

### 4.7 安全设计

- 认证：OAuth2 + JWT（access_token 15 min + refresh_token 7 d）
- 授权：RBAC 模型，支持动态角色与数据权限
- 加密：TLS 1.3 全链路；敏感字段 AES-256-GCM，密钥托管于 Vault
- 审计：关键操作落库（who、what、when、where），保留 ≥ 180 d
- 网络隔离：生产与测试分 VPC，数据库仅内网可达，WAF 拦截常见 OWASP Top 10 攻击

### 4.8 可扩展性考虑

- 水平扩展：所有业务服务无状态，Pod 数量可随流量线性扩展
- 数据扩展：分库分表键可二次哈希；OpenSearch 支持索引滚动与冷热分层
- 功能扩展：插件化网关、消息消费端采用策略模式，新业务可快速注册 topic 与路由

### 4.9 版本与配置管理

- 语义化版本：v<major>.<minor>.<patch>，预发布采用 -rc1/-beta1
- 配置中心：Nacos 命名空间隔离（dev/sit/uat/prod），支持灰度发布与回滚
- 密钥/证书：Vault 动态租约，自动续期，无需重启 Pod

## 5 详细设计说明书

&gt; 本节面向“开发者 + 测试 + 运维”三角，给出可直接落地的设计细节，全部用 Markdown 文本描述，无图。

---

### 5.1 核心类图（文本描述）

采用“贫血模型 + 领域服务”混合方式，关键类与职责如下：

| 类/接口 | 包名 | 主要职责 | 备注 |
|---|---|---|---|
| UserEntity | domain.user | 用户聚合根，保存手机号、密码散列、状态 | 无业务行为 |
| UserDomainService | domain.user | 注册流程编排、密码加密、事件发布 | 纯内存，无依赖 |
| UserRepository | domain.user | 持久化接口 | out-ports |
| UserJpaAdapter | adapter.jpa | 基于 Spring Data JPA 实现 | out-adapters |
| RegisterController | adapter.web | REST 入口，DTO 校验 | in-adapters |
| UserRegisterUseCase | application.port.in | 输入端口，接口层 | application |
| DomainEventPublisher | application.event | 发布“用户已注册”事件 | application |

依赖关系（由外到内）：
web-adapter → application → domain → (仅抽象) → jpa-adapter

---

### 5.2 接口定义（OpenAPI 3.1 文本）

```yaml
POST /api/v1/users/register
summary: 用户注册
tags:
  - User
requestBody:
  required: true
  content:
    application/json:
      schema:
        type: object
        properties:
          phone:
            type: string
            pattern: '^1[3-9]\d{9}$'
            example: '13812345678'
          password:
            type: string
            minLength: 8
            maxLength: 32
            example: 'Demo@1234'
          smsCode:
            type: string
            pattern: '^\d{6}$'
responses:
  '201':
    description: 注册成功
    headers:
      Location:
        schema:
          type: string
          example: /api/v1/users/10001
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/UserDTO'
  '400':
    description: 参数错误
    content:
      application/json:
        schema:
          $ref: '#/components/schemas/Error'
### 5.3 数据库设计（完整 DDL 与规范）

以下脚本均兼容 MySQL 8.0+，采用 utf8mb4_0900_ai_ci 排序规则，所有表均含 `created_at` / `updated_at` 审计字段。

#### 5.3.1 用户表（水平分 32 张，分片键 phone_hash）

```sql
CREATE TABLE `user_0` (
  `id`          bigint unsigned NOT NULL AUTO_INCREMENT,
  `phone`       char(11)        NOT NULL,
  `phone_hash`  int             NOT NULL COMMENT '分片哈希',
  `password`    char(60)        NOT NULL COMMENT 'bcrypt 散列',
  `nickname`    varchar(64)     DEFAULT NULL,
  `status`      tinyint         NOT NULL DEFAULT 1 COMMENT '1 正常 2 冻结',
  `created_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_phone` (`phone`),
  KEY `idx_phone_hash` (`phone_hash`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `product_spu` (
  `id`          bigint unsigned NOT NULL AUTO_INCREMENT,
  `name`        varchar(120)    NOT NULL,
  `category_id` int unsigned    NOT NULL,
  `brand`       varchar(60)     DEFAULT NULL,
  `status`      tinyint         NOT NULL DEFAULT 1 COMMENT '1 上架 2 下架',
  `created_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_category` (`category_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;



CREATE TABLE `product_spu` (
  `id`          bigint unsigned NOT NULL AUTO_INCREMENT,
  `name`        varchar(120)    NOT NULL,
  `category_id` int unsigned    NOT NULL,
  `brand`       varchar(60)     DEFAULT NULL,
  `status`      tinyint         NOT NULL DEFAULT 1 COMMENT '1 上架 2 下架',
  `created_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_category` (`category_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `product_sku` (
  `id`          bigint unsigned NOT NULL AUTO_INCREMENT,
  `spu_id`      bigint unsigned NOT NULL,
  `title`       varchar(120)    NOT NULL,
  `price`       decimal(10,2)   NOT NULL,
  `stock`       int unsigned    NOT NULL DEFAULT 0,
  `version`     int unsigned    NOT NULL DEFAULT 0 COMMENT '乐观锁',
  `created_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at`  datetime        NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  KEY `idx_spu` (`spu_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `order` (
  `id`          bigint          NOT NULL COMMENT '雪花 ID',
  `user_id`     bigint          NOT NULL,
  `amount`      decimal(10,2)   NOT NULL,
  `status`      tinyint         NOT NULL DEFAULT 1 COMMENT '状态机',
  `created_at`  datetime        NOT NULL,
  `updated_at`  datetime        NOT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_user_created` (`user_id`,`created_at`)
) ENGINE=InnoDB
PARTITION BY RANGE (year(created_at)*100 + month(created_at))
(PARTITION p202501 VALUES LESS THAN (202502),
 PARTITION p202502 VALUES LESS THAN (202503));




 CREATE TABLE `order_item` (
  `id`          bigint unsigned NOT NULL AUTO_INCREMENT,
  `order_id`    bigint          NOT NULL,
  `sku_id`      bigint unsigned NOT NULL,
  `quantity`    int unsigned    NOT NULL,
  `price`       decimal(10,2)   NOT NULL COMMENT '成交单价',
  `discount`    decimal(10,2)   NOT NULL DEFAULT 0.00,
  PRIMARY KEY (`id`),
  KEY `idx_order` (`order_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;




````
